<%- include('partial/header') %>
<div style="height: 10vh;">

</div>
<div class="container d-flex justify-content-center align-items-center flex-column min-vh-100">
    <div class="container p-4 rounded" style="background-color: rgba(0, 0, 0, 0.63); backdrop-filter: blur(15px);">
        <h2 class="text-center mb-4 text-white">Student List</h2>

        <!-- Search Bar -->
        <div class="mb-3 d-flex">
            <input type="text" id="searchInput" class="form-control text-success" placeholder="Search by Name or Email...">
            <button type="submit" id="searchButton" class="btn btn-primary ms-2">Search</button>
        </div>

        <!-- Scrollable Table -->
        <div style="max-height: 400px; overflow-y: auto; background-color: rgba(255, 255, 255, 0.1); border-radius: 10px;">
            <table class="table table-bordered table-hover text-center">
                <thead class="table-dark" style="position: sticky; top: 0; background-color: rgba(0, 0, 0, 0.8); color: white;">
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Phone</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <% users.forEach(user => { %>
                        <% if (user.role === 'student'){ %>
                        <tr>
                            <td><%= user.randomId %></td>
                            <td class="user-name"><%= user.name %></td>
                            <td class="user-email"><%= user.email %></td>
                            <td><%= user.role %></td>
                            <td>
                                <%= user.phone %>
                            </td>
                            <td>
                                <%= user.status %>
                            </td>
                        </tr>
                        <% } %>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
    <div style="height: 50px; background-color: transparent;">

    </div>
</div>
</div>

<script>
    $(document).ready(function() {
        // Status Toggle Switch
        $(".status-switch").on("change", function() {
            let userId = $(this).data("userid");
            let newStatus = $(this).prop("checked") ? "active" : "inactive";

            $.ajax({
                url: "/update-status",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({ userId, newStatus }),
                success: function(response) {
                    alert("User status updated successfully!");
                },
                error: function(err) {
                    alert("Error updating status");
                    console.log(err);
                }
            });
        });

        // Search Filter
        $("#searchInput").on("keyup", function() {
            let value = $(this).val().toLowerCase();
            $("#userTableBody tr").filter(function() {
                $(this).toggle(
                    $(this).find(".user-name").text().toLowerCase().includes(value) ||
                    $(this).find(".user-email").text().toLowerCase().includes(value)
                );
            });
        });
    });
</script>
</div>
    

<%- include('partial/footer') %>
     

   